---
- name: Set git safe directory
  community.general.git_config:
    name: safe.directory
    scope: global
    value: "*"
  become_user: "{{ item }}"
  with_items:
    - "{{ service_user }}"
    - "root"
    - "ec2-user"

- name: Update local repo with mirrors list
  git:
    repo: "https://github.com/AlmaLinux/mirrors.git"
    dest: "{{ config_root }}/mirrors/updates"
    clone: yes
    update: yes
    force: yes
    accept_hostkey: yes
    track_submodules: no


- name: Change owner of local repo
  file:
    path: "{{ config_root }}/mirrors/updates"
    owner: "{{ service_user }}"
    group: "{{ service_user }}"
    recurse: yes
